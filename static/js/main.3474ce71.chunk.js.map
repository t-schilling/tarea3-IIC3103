{"version":3,"sources":["componentes/Socket.js","componentes/Chat.js","componentes/Info.js","App.js","index.js"],"names":["socket","require","connect","path","Chat","username","useState","mensaje","setMensaje","mensajes","setMensajes","useEffect","on","date","message","name","concat","off","className","map","e","i","Date","onSubmit","preventDefault","emit","htmlFor","id","cols","value","onChange","target","Info","trucks","setTrucks","positions","setPosition","console","log","truck","obj","code","position","find","element","undefined","source","status","truck_object","MapContainer","center","zoom","scrollWheelZoom","TileLayer","attribution","url","dat","Polyline","pathOptions","color","origin","destination","onClick","a","fixTruck","App","setUsername","registrado","setRegistrado","align","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3474ce71.chunk.js","sourcesContent":["//import io from 'socket.io-client';\n\nconst io = require(\"socket.io-client\");\n\nvar socket = io.connect('wss://tarea-3-websocket.2021-2.tallerdeintegracion.cl', {path: '/trucks'});\n\nexport default socket;","import React, {useState, useEffect} from 'react';\nimport socket from './Socket';\n\nconst Chat = ({username}) => {\n     \n    const [mensaje, setMensaje] = useState('');\n    const[mensajes, setMensajes] = useState([]);\n\n    const[trucks, setTrucks] = useState([]);\n    const[positions, setPosition] = useState([[]])\n\n\n    useEffect(() => {\n        //console.log('recibiendo mensajes')\n        socket.on('CHAT', ({date, message, name}) => {\n            //console.log(name+':'+message + '->('+date+')');\n            setMensajes(mensajes.concat({date, message, name}));\n        });\n        \n        return () => {\n            socket.off('CHAT');\n      };\n    },[mensajes]);\n\n    const submit = (e) => {\n        e.preventDefault();\n        //console.log({message : mensaje, name : username})\n        socket.emit('CHAT', {message : mensaje, name : username})\n        setMensaje(\"\");\n    }\n\n\n    return (\n\n        <div className=\"chat_todo\">\n            <div><h2>Chat</h2></div>\n            <div className=\"chat\"> \n                {mensajes.map((e,i) => <div  key={i}> \n                    <div>[{Date(e.date)}] -- {e.name}: {e.message}</div>\n                </div>)}\n            </div>\n            <form className=\"chat_form\" onSubmit={submit}>\n                <label htmlFor=\"\"> Escriba su mensaje : \n                </label>\n                <textarea name=\"\" id=\"\" cols=\"30\" value={mensaje} onChange={e => setMensaje(e.target.value)}>\n\n                </textarea>\n            <button> Enviar mensaje</button>\n\n\n            </form>\n\n        </div>\n    )\n}\n\nexport default Chat;","import React, {useState, useEffect} from 'react';\nimport socket from './Socket';\nimport { MapContainer, TileLayer, Polyline, Tooltip, Marker, Circle} from 'react-leaflet';\nimport './Map.css';\nimport './../App.css'\n\nconst Info = () => {\n\n    const[trucks, setTrucks] = useState([]);\n    const[positions, setPosition] = useState([[]]);\n\n    \n    useEffect(() => {\n        console.log('Recibiendo info de TRUCKS');\n        socket.on('TRUCKS', truck =>{\n            //console.log('--->el code es' + truck[0].code)\n            setTrucks(trucks.concat(truck));\n            \n\n        });\n        return () => {socket.off('TRUCKS')};\n    },[trucks]);\n\n    useEffect(() => {\n        \n        socket.on( 'POSITION', (obj) => {setPosition(positions.concat([{code: obj.code, position : obj.position}]));\n        let truck  = trucks.find(element => element.code === obj.code);\n            if (truck === undefined){\n                console.log( \"Truck not found\");\n            }\n            else{\n                truck.position = obj.position;\n                //console.log('Nueva posicion de: ' + truck.truck + '['+ truck.position+ ']');\n            } \n        });\n        return () => {socket.off('POSITION')};\n    });\n\n    useEffect(() => {\n        socket.on('FAILURE', ({code, source}) => { \n            let truck  = trucks.find(element => element.code === code);\n            if (typeof(truck) === undefined){\n                return \"Truck not found\";\n            }\n            else{\n                truck.status = source;\n            }\n        });\n        return () => {socket.off('FAILURE')}\n    });\n\n    useEffect(() => {\n        socket.on('FIX', (truck_object) =>{\n            console.log('solucionando el problema de: ' + truck_object.code);\n            let truck  = trucks.find(element => element.code === truck_object.code);\n            if (typeof(truck) === undefined){\n                return \"Truck not found\";\n            }\n            else{\n                truck.status = 'Ok';\n            }\n        });\n        return () => {socket.off('FIX')}\n    });\n\n    const truckInfo = (code) => {\n        let truck  = trucks.find(element => element.code === code);\n        //console.log(truck)\n        if (truck === undefined){\n            return (\"Truck not found\");\n        }\n        //console.log('ahora tenemos' + truck)\n        return (<div>\n            <p>'Truck:' {truck.truck}</p><br />\n            <p>'Code: '{truck.code}</p><br />\n            <p>'Origin: '{truck.origin}' -- Destination: '{truck.destination}</p><br />\n            <p>'Status: '{truck.status}</p> <br />\n        </div>)   \n    };\n\n    const fixTruck = (e) =>{\n        //console.log('Vamos a reparar el siguiente camion: ' + e);\n        socket.emit('FIX', {code : e});\n    }\n\n    const changeStatus = () => {\n        for (let element of trucks){\n            if(element.status == undefined || element.status == ''){\n                element.status = 'Ok';\n            }\n        }\n    }\n\n    return (\n        <div>\n            <div className=\"mapArea\">\n                <MapContainer center={[-21.976193,-68.79]} zoom={11} scrollWheelZoom={false}>\n                <TileLayer\n                attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n                />\n\n                {trucks.map((dat) => {\n                    return (\n                        <div key={dat.code}>\n                        <Polyline pathOptions={{color:'black'}} positions={[dat.origin, dat.destination]} />\n                        </div>\n                    )\n                })}\n                \n                \n                \n                \n            \n                    \n                </MapContainer>\n            </div>\n\n\n            \n        <div className=\"infoArea\">\n            <div className=\"info_titulo\">\n                <div><h2>Trucks Information:</h2></div>\n                <div className=\"solo_info\"> \n                    {trucks.map((e,i) => <div  key={i}> \n                    <div> \n                        <div className='truckInfo_container'>\n                        <div>Truck: {e.truck}</div>\n                        <div>Code: {e.code}</div>\n                        <div>Origin: {e.origin} </div>\n                        <div>Destination: {e.destination} </div>\n                        <div>Status: {e.status} </div>\n                        <div>\n                        {(e.status !== ('Ok')) && \n                            <button value={e.code} onClick={a => fixTruck(a.target.value)}>Fix Truck</button>}\n\n\n                    </div>\n                        </div>\n                    </div>\n                    </div>)}\n                </div>\n            </div>\n        </div>\n    </div>    \n\n    )\n}\n\nexport default Info;","import React, {useState} from 'react';\nimport socket from './componentes/Socket';\nimport Chat from './componentes/Chat';\nimport Info from './componentes/Info';\nimport './App.css';\n\nfunction App() {\n\n  const [username, setUsername] = useState(\"\");\n  const [registrado, setRegistrado] = useState(false);\n\n  const registrar = (e) => {\n    socket.emit('TRUCKS');\n    //console.log('Emitiendo TRUCKS')\n    //console.log('el nombre de usuario es :' + username)\n    e.preventDefault();\n    if (username !== ''){\n      setRegistrado(true);\n      //console.log('registrado = ' + registrado)\n    }\n  }\n\n\n\n  return (\n    <div className=\"App\">\n      <div className=\"titleArea\"><h1 align=\"center\">Tarea 3</h1>\n      \n      {\n        !registrado && \n\n        <form className=\"logIn\" onSubmit={registrar}>\n          <label> Escoja un nombre de usuario:</label>\n          <input value={username} onChange={e => setUsername(e.target.value)}></input>\n          <button>Ingresar a la pagina</button>\n        </form>\n      }\n      {\n        registrado &&\n\n        <div className=\"chatArea\"> <Chat username={username}/> </div>\n      }\n\n      {\n        registrado &&\n        \n          <Info/>\n      }\n\n\n    </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n//import reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n//reportWebVitals();\n"],"sourceRoot":""}